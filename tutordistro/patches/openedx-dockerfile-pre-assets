ENV NO_PYTHON_UNINSTALL 1
ENV NO_PREREQ_INSTALL 1
RUN openedx-assets xmodule \
    && openedx-assets npm \
    && openedx-assets webpack --env=prod \
    && openedx-assets common
COPY --chown=app:app ./themes/ {{ DISTRO_THEMES_ROOT }}
{%- if DISTRO_BRAGI_COLORS|count > 0 -%}
{%- for bragi_color in DISTRO_BRAGI_COLORS %}
RUN mkdir {{ DISTRO_THEMES_ROOT }}/ednx-saas-themes/edx-platform/{{bragi_color}} \
    && cp -R {{ DISTRO_THEMES_ROOT }}/ednx-saas-themes/edx-platform/bragi-generator/{{bragi_color}} {{ DISTRO_THEMES_ROOT }}/ednx-saas-themes/edx-platform/{{bragi_color}}
{% endfor -%}
{%- endif -%}
RUN openedx-assets themes \
    --theme-dirs {{ DISTRO_THEME_DIRS | join(' ') }} \
    --themes {{ DISTRO_THEMES_NAME | join(' ') }} \
    && openedx-assets collect --settings=tutor.assets \
    && rdfind -makesymlinks true -followsymlinks true /openedx/staticfiles/
